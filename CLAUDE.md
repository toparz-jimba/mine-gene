# CLAUDE.md

このファイルはClaude Code (claude.ai/code) がこのリポジトリのコードを扱う際のガイダンスを提供します。

## プロジェクト概要

これは高度な機能を持つモバイル最適化されたマインスイーパーゲームで、バニラJavaScript/HTML/CSSで書かれています。プロジェクトは複数のゲームバリエーションをサポートする継承ベースのクラス構造を持つモジュラーアーキテクチャを使用しています。

## コアアーキテクチャ

### クラス階層

- `MinesweeperCore` (minesweeper-core.js): コアゲームロジック、タイマー、地雷配置、勝敗判定を含む基底クラス
- `PCMinesweeper` (pc-base.js): デスクトップコントロールとUIを備えたMinesweeperCoreを拡張したPC最適化版
- `PCProMinesweeper` (game.js): 確率計算、CSPソルバー、盤面管理、補助モードなどの高度な機能を持つPCMinesweeperを拡張したプロ版

### 主要ファイル構造

- `index.html`: モーダル、コントロール、PRO機能を持つメインゲームインターフェース
- `style.css`: レスポンシブデザイン、テーマ、PRO機能の完全なスタイリング
- `minesweeper-core.js`: コアゲームロジック基底クラス
- `pc-base.js`: PC版基本機能
- `game.js`: メインPROゲーム実装
- `modules/csp-solver.js`: 確率計算用制約充足問題ソルバー

### ゲーム機能

- **基本ゲームプレイ**: タッチ/マウス操作対応の標準マインスイーパー
- **PRO機能**:
  - CSPソルバーを使用した確率計算
  - 地雷予測付き補助モード
  - 盤面エディターと保存/読み込みシステム
  - 盤面インポート/エクスポート機能
  - 隠し難易度を含む複数の難易度レベル
- **レスポンシブデザイン**: ズームコントロールとタッチ最適化を持つモバイルファースト
- **テーマ**: 省電力オプション付きライト/ダークモード

## 開発コマンド

これはビルドシステムを持たないバニラJavaScriptプロジェクトです。開発は直接行います：

1. **ローカル開発**: ウェブブラウザで`index.html`を開くか、ローカルHTTPサーバーでサーブ
2. **テスト**: ブラウザでの手動テスト（自動テストフレームワークなし）
3. **GitHub Pagesデプロイ**: main/masterブランチにプッシュ（GitHub Pages用に設定済み）

## 主要開発パターン

### 新機能の追加

- 適切なクラスを拡張（Core → PC → PCPro）
- `setupProEventListeners()`の既存イベントリスナーパターンに従う
- `minesweeper-pro-`プレフィックス付きでlocalStorageを永続設定に使用
- 既存のモーダル/コントロール構造に従ってindex.htmlにUI要素を追加

### 盤面管理システム

- 盤面は軽量JSONとしてlocalStorageに保存
- 盤面データ生成には`createBoardData()`を使用
- エディターモードは別の`editorMines`と`editorRevealed`セットを使用
- インポート/エクスポートは'MS-'プレフィックス付きBase64エンコードを使用

### 確率システム

- CSPソルバーが開示された制約に基づいて地雷確率を計算
- 再計算を避けるため永続確率をキャッシュ
- 表示モード：パーセンテージオーバーレイ、色分け、補助ポップアップ
- 複雑な計算のためのタイムアウト処理をサポート

### UI状態管理

- classList add/remove 'show'によるモーダル管理
- 自動復元付きlocalStorageに設定を保存
- 複合モーダル（盤面管理）用タブシステム
- レスポンシブズームとフォントサイズコントロール

## コーディング規約

- すべてのJavaScript識別子にはcamelCaseを使用
- クラスメソッドは機能別にグループ化
- クリーンアップのためイベントハンドラーをクラスプロパティとして保存
- 開発用に[DEBUG]プレフィックス付きでコンソールログ出力
- HTMLはIDとCSSクラスにkebab-caseを使用
- CSSはテーマにCSSカスタムプロパティを使用

## 重要な注意事項

- これは純粋なバニラJavaScriptプロジェクト - フレームワークやビルドツールなし
- ゲーム状態は完全にメモリで管理（localStorageは設定/盤面のみ）
- デスクトップ拡張機能付きモバイルファーストレスポンシブデザイン
- 日本語UI（コメントと文字列）
- GitHub Pages対応（.nojekyllファイル含む）