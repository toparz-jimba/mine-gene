<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>マインスイーパー PC PRO版</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="flag-animation-container"></div>
    <div class="container">
        <header class="game-header">
            <div class="info-panel">
                <div class="info-item-group">
                    <div class="info-item">
                        <span class="emoji">🚩</span>
                        <span id="flag-count">0/10</span>
                    </div>
                    <div class="info-item">
                        <span class="emoji">💣</span>
                        <span id="mine-remaining">10</span>
                    </div>
                </div>
                <div class="center-group">
                    <button id="reset-btn" class="reset-btn">リセット</button>
                    <button id="retry-btn" class="retry-btn" style="display: none;">リトライ</button>
                </div>
                <div class="timer-group">
                    <div class="displays-container">
                        <div class="assist-display-container"></div>
                    </div>
                    <div class="info-item">
                        <span class="emoji"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><polyline points="12,6 12,12 16,14"/></svg></span>
                        <span id="timer">000</span>
                    </div>
                </div>
            </div>
        </header>

        <div class="game-board-wrapper">
            <div class="game-board" id="game-board"></div>
        </div>
        
        <div class="controls">
            <div class="zoom-controls">
                <button id="zoom-out-btn" class="zoom-btn">－</button>
                <button id="zoom-in-btn" class="zoom-btn">＋</button>
            </div>
            <button id="settings-btn" class="control-btn">
                <span class="settings-icon"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z"/><circle cx="12" cy="12" r="3"/></svg></span>
            </button>
            
            <!-- PRO版専用コントロール -->
            <div class="pro-controls">
                <button id="probability-btn" class="control-btn" title="地雷確率表示">
                    <span><svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z"/></svg>確率</span>
                </button>
                <button id="assist-btn" class="control-btn" title="補助モード">
                    <span><svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v6m6-6h-6m-6 0h6"/></svg>補助</span>
                </button>
                <button id="board-manager-btn" class="control-btn" title="盤面管理">
                    <span><svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>盤面</span>
                </button>
            </div>
        </div>

        <button id="help-btn" class="help-btn-floating">
            <span class="help-icon">？</span>
        </button>

        <div class="settings-modal" id="settings-modal">
            <div class="settings-modal-content">
                <div class="settings-header">
                    <h2>設定</h2>
                    <button id="close-settings" class="close-btn"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button>
                </div>
                <div class="settings-body">
                    <div class="settings-section">
                        <h3>難易度</h3>
                        <select id="difficulty-select" class="difficulty-select-modal">
                            <option value="easy" selected>初級 (9×9, 地雷10)</option>
                            <option value="medium">中級 (16×16, 地雷40)</option>
                            <option value="hard">上級 (16×30, 地雷99)</option>
                            <option value="hiddeneasy">裏初級 (9×9, 地雷20)</option>
                            <option value="hiddenmedium">裏中級 (16×16, 地雷64)</option>
                            <option value="hiddenhard">裏上級 (16×30, 地雷120)</option>
                            <option value="extreme">極悪 (64×64, 地雷999)</option>
                        </select>
                    </div>
                    <div class="settings-section">
                        <h3>文字サイズ</h3>
                        <div class="settings-controls">
                            <button id="font-size-down-btn" class="settings-btn">小</button>
                            <span id="font-size-display" class="settings-value">100%</span>
                            <button id="font-size-up-btn" class="settings-btn">大</button>
                        </div>
                    </div>
                    <div class="settings-section">
                        <h3>テーマ</h3>
                        <button id="theme-toggle-btn" class="settings-toggle-btn">
                            <span class="theme-icon"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="M4.93 4.93l1.41 1.41"/><path d="M17.66 17.66l1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="M6.34 17.66l-1.41 1.41"/><path d="M19.07 4.93l-1.41 1.41"/></svg></span>
                            <span class="theme-text">ライトモード</span>
                        </button>
                    </div>
                    <div class="settings-section">
                        <h3>旗アニメーション</h3>
                        <button id="flag-animation-toggle-btn" class="settings-toggle-btn">
                            <span class="flag-animation-icon">🚩</span>
                            <span class="flag-animation-text">ON</span>
                        </button>
                    </div>
                    <div class="settings-section">
                        <h3>グラデーション・影</h3>
                        <button id="power-save-toggle-btn" class="settings-toggle-btn">
                            <span class="power-save-icon"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.362 5.214A8.252 8.252 0 0112 21 8.25 8.25 0 016.038 7.048 8.287 8.287 0 009 9.6a8.983 8.983 0 013.361-6.867 8.21 8.21 0 003 2.48z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18a3.75 3.75 0 00.495-7.467 5.99 5.99 0 00-1.925 3.546 5.974 5.974 0 01-2.133-1A3.75 3.75 0 0012 18z"/></svg></span>
                            <span class="power-save-text">ON</span>
                        </button>
                        <p style="font-size: 12px; color: var(--text-secondary); margin-top: 10px;">OFFで消費電力を削減</p>
                    </div>
                    <div class="settings-section">
                        <h3>補助機能の色付け表示</h3>
                        <button id="assist-visual-toggle-btn" class="settings-toggle-btn">
                            <span class="assist-visual-icon"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></span>
                            <span class="assist-visual-text">ON</span>
                        </button>
                        <p style="font-size: 12px; color: var(--text-secondary); margin-top: 10px;">OFFの時は補助機能のポップアップのみ使用</p>
                    </div>
                    <div class="settings-section">
                        <h3>リバース操作</h3>
                        <button id="reverse-toggle-btn" class="settings-toggle-btn">
                            <span class="reverse-icon"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"/></svg></span>
                            <span class="reverse-text">OFF</span>
                        </button>
                        <p style="font-size: 12px; color: var(--text-secondary); margin-top: 10px;">スワイプ操作を反転します</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="help-modal" id="help-modal">
            <div class="help-modal-content">
                <div class="help-header">
                    <h2>操作説明</h2>
                    <button id="close-help" class="close-btn"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
                </div>
                <div class="help-body">
                    <div class="help-section" id="mobile-help">
                        <h3><svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>スマートフォン・タブレット</h3>
                        <div class="help-item">
                            <span class="help-action">タップ</span>
                            <span class="help-description">マスを開く</span>
                        </div>
                        <div class="help-item">
                            <span class="help-action">長押し</span>
                            <span class="help-description">旗を立てる/外す</span>
                        </div>
                        <div class="help-item">
                            <span class="help-action">＋/－ボタン</span>
                            <span class="help-description">拡大・縮小</span>
                        </div>
                        <div class="help-item">
                            <span class="help-action">スワイプ</span>
                            <span class="help-description">ボードを移動（拡大時）</span>
                        </div>
                    </div>
                    <div class="help-section" id="pc-help">
                        <h3>💻 パソコン</h3>
                        <div class="help-item">
                            <span class="help-action">左クリック</span>
                            <span class="help-description">マスを開く</span>
                        </div>
                        <div class="help-item">
                            <span class="help-action">右クリック</span>
                            <span class="help-description">旗を立てる/外す</span>
                        </div>
                        <div class="help-item">
                            <span class="help-action">＋/－ボタン</span>
                            <span class="help-description">拡大・縮小</span>
                        </div>
                        <div class="help-item">
                            <span class="help-action">中ボタンでドラッグ</span>
                            <span class="help-description">ボードを移動（拡大時）</span>
                        </div>
                    </div>
                    <div class="help-section">
                        <h3><svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 4a2 2 0 114 0v1a1 1 0 001 1h3a1 1 0 011 1v3a1 1 0 01-1 1h-1a2 2 0 100 4h1a1 1 0 011 1v3a1 1 0 01-1 1h-3a1 1 0 01-1-1v-1a2 2 0 10-4 0v1a1 1 0 01-1 1H7a1 1 0 01-1-1v-3a1 1 0 00-1-1H4a2 2 0 110-4h1a1 1 0 001-1V7a1 1 0 011-1h3a1 1 0 001-1V4z"></path></svg>ゲームルール</h3>
                        <p>地雷を避けながらすべての安全なマスを開くゲームです。数字は周囲8マスの地雷数を示します。</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ゲームクリアモーダル -->
    <div id="clear-modal" class="modal">
        <div class="modal-content clear-modal-content">
            <div class="clear-modal-header">
                <span class="clear-icon"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path></svg></span>
                <h2>クリア！</h2>
            </div>
            <p id="clear-message" class="clear-message"></p>
            <div class="clear-modal-buttons">
                <button id="next-difficulty-btn" class="clear-btn next-btn">次の難易度へ</button>
            </div>
        </div>
    </div>
    
    <!-- PRO版専用モーダル -->
    <!-- 盤面管理モーダル -->
    <div class="board-manager-modal" id="board-manager-modal">
        <div class="board-manager-modal-content">
            <div class="board-manager-header">
                <h2 id="board-manager-title">盤面管理</h2>
                <button id="close-board-manager" class="close-btn"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button>
            </div>
            <div class="board-manager-tabs">
                <button id="saved-boards-tab" class="tab-btn active">保存済み盤面</button>
                <button id="board-editor-tab" class="tab-btn">エディター</button>
                <button id="import-export-tab" class="tab-btn">インポート/エクスポート</button>
            </div>
            
            <!-- 保存済み盤面タブ -->
            <div id="saved-boards-content" class="tab-content active">
                <div class="saved-boards-header">
                    <button id="save-current-board" class="board-action-btn primary">現在の盤面を保存</button>
                    <div class="board-search">
                        <input type="text" id="board-search-input" placeholder="盤面名で検索..." class="search-input">
                    </div>
                </div>
                <div id="saved-boards-list" class="saved-boards-list">
                    <div class="empty-state">保存された盤面がありません</div>
                </div>
            </div>
            
            <!-- エディタータブ -->
            <div id="board-editor-content" class="tab-content">
                <div class="editor-header">
                    <div class="editor-info">
                        <input type="text" id="board-name-input" placeholder="盤面名を入力..." class="board-name-input">
                        <div class="editor-stats">
                            <span>地雷数: <span id="mine-count-display">0</span></span>
                            <span>サイズ: <span id="board-size-display">9×9</span></span>
                        </div>
                    </div>
                    <div class="editor-controls">
                        <div class="editor-mode-selector">
                            <button id="mine-mode-btn" class="editor-btn primary">地雷配置</button>
                            <button id="reveal-mode-btn" class="editor-btn secondary">開く設定</button>
                        </div>
                        <button id="save-edited-board" class="editor-btn primary">保存</button>
                        <button id="test-board-btn" class="editor-btn primary">テストプレイ</button>
                    </div>
                </div>
                <div class="editor-instructions">
                    <p>クリックで地雷を配置/削除できます。右クリックで連続配置モードを切り替えできます。</p>
                </div>
            </div>
            
            <!-- インポート/エクスポートタブ -->
            <div id="import-export-content" class="tab-content">
                <div class="import-export-section">
                    <h3>エクスポート</h3>
                    <div class="export-controls">
                        <button id="export-current-btn" class="board-action-btn secondary">現在の盤面をコード化</button>
                        <textarea id="export-code-area" class="code-area" readonly placeholder="盤面コードがここに表示されます"></textarea>
                        <button id="copy-export-btn" class="copy-btn">コピー</button>
                    </div>
                </div>
                <div class="import-export-section">
                    <h3>インポート</h3>
                    <div class="import-controls">
                        <textarea id="import-code-area" class="code-area" placeholder="盤面コードを貼り付けてください"></textarea>
                        <button id="import-board-btn" class="board-action-btn primary">盤面を読み込み</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- スピードラン完了モーダル -->
    <div id="speedrun-complete-modal" class="modal">
        <div class="modal-content speedrun-modal-content">
            <div id="speedrun-content"></div>
        </div>
    </div>
    
    <script src="minesweeper-core.js"></script>
    <script src="pc-base.js"></script>
    <script src="modules/csp-solver.js"></script>
    <script src="game.js"></script>
</body>
</html>